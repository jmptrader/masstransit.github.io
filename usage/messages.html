<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Messages | MassTransit</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#3a0839">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="description" content="A free, open-source distributed application framework for .NET.">
    <meta name="msapplication-TileColor" content="#3a0839">
    <meta name="msapplication-config" content="/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/assets/css/0.styles.75c9abf4.css" as="style"><link rel="preload" href="/assets/js/app.195ff7db.js" as="script"><link rel="preload" href="/assets/js/3.49f501da.js" as="script"><link rel="preload" href="/assets/js/121.bf5544df.js" as="script"><link rel="prefetch" href="/assets/js/10.a0cd44ab.js"><link rel="prefetch" href="/assets/js/100.9feb174f.js"><link rel="prefetch" href="/assets/js/101.f3afae1f.js"><link rel="prefetch" href="/assets/js/102.edc3cfd3.js"><link rel="prefetch" href="/assets/js/103.396b5261.js"><link rel="prefetch" href="/assets/js/104.35ef931e.js"><link rel="prefetch" href="/assets/js/105.75295f36.js"><link rel="prefetch" href="/assets/js/106.c42d7948.js"><link rel="prefetch" href="/assets/js/107.4cddb7d4.js"><link rel="prefetch" href="/assets/js/108.6d56d230.js"><link rel="prefetch" href="/assets/js/109.3a2c9c0e.js"><link rel="prefetch" href="/assets/js/11.3d40bd0b.js"><link rel="prefetch" href="/assets/js/110.c4aa15ea.js"><link rel="prefetch" href="/assets/js/111.c661ab49.js"><link rel="prefetch" href="/assets/js/112.0f444d04.js"><link rel="prefetch" href="/assets/js/113.b7745232.js"><link rel="prefetch" href="/assets/js/114.1f4ecadb.js"><link rel="prefetch" href="/assets/js/115.6acc0049.js"><link rel="prefetch" href="/assets/js/116.59b4c1e7.js"><link rel="prefetch" href="/assets/js/117.0089265d.js"><link rel="prefetch" href="/assets/js/118.dee3db3a.js"><link rel="prefetch" href="/assets/js/119.c2dd72f1.js"><link rel="prefetch" href="/assets/js/12.67901ed9.js"><link rel="prefetch" href="/assets/js/120.2f521996.js"><link rel="prefetch" href="/assets/js/122.f63abbe1.js"><link rel="prefetch" href="/assets/js/123.d34457fe.js"><link rel="prefetch" href="/assets/js/124.39757413.js"><link rel="prefetch" href="/assets/js/125.5ae9566e.js"><link rel="prefetch" href="/assets/js/126.73bcf6ec.js"><link rel="prefetch" href="/assets/js/127.3d4534d5.js"><link rel="prefetch" href="/assets/js/128.c47aea17.js"><link rel="prefetch" href="/assets/js/129.e6499def.js"><link rel="prefetch" href="/assets/js/13.773b7e4f.js"><link rel="prefetch" href="/assets/js/130.30e02611.js"><link rel="prefetch" href="/assets/js/131.371a8da4.js"><link rel="prefetch" href="/assets/js/132.f5ff377c.js"><link rel="prefetch" href="/assets/js/133.edee58ae.js"><link rel="prefetch" href="/assets/js/134.40abac7e.js"><link rel="prefetch" href="/assets/js/135.7b10e613.js"><link rel="prefetch" href="/assets/js/136.6c4a4c9e.js"><link rel="prefetch" href="/assets/js/137.898fd9a1.js"><link rel="prefetch" href="/assets/js/138.c6591b9d.js"><link rel="prefetch" href="/assets/js/139.27a7976e.js"><link rel="prefetch" href="/assets/js/14.162fd7de.js"><link rel="prefetch" href="/assets/js/140.8f5fbf89.js"><link rel="prefetch" href="/assets/js/141.d2c4074e.js"><link rel="prefetch" href="/assets/js/142.ca465ae2.js"><link rel="prefetch" href="/assets/js/143.74deca00.js"><link rel="prefetch" href="/assets/js/144.70d74a91.js"><link rel="prefetch" href="/assets/js/145.6b2b56f8.js"><link rel="prefetch" href="/assets/js/146.f192058f.js"><link rel="prefetch" href="/assets/js/147.2dd1eca6.js"><link rel="prefetch" href="/assets/js/148.63cb766b.js"><link rel="prefetch" href="/assets/js/149.ecc8a933.js"><link rel="prefetch" href="/assets/js/15.5698f0da.js"><link rel="prefetch" href="/assets/js/150.4b4c3db8.js"><link rel="prefetch" href="/assets/js/16.5359a736.js"><link rel="prefetch" href="/assets/js/17.e09dee46.js"><link rel="prefetch" href="/assets/js/18.89fe105c.js"><link rel="prefetch" href="/assets/js/19.0ba8fb0f.js"><link rel="prefetch" href="/assets/js/20.a337dd2d.js"><link rel="prefetch" href="/assets/js/21.93618127.js"><link rel="prefetch" href="/assets/js/22.2956ed34.js"><link rel="prefetch" href="/assets/js/23.e7e073ac.js"><link rel="prefetch" href="/assets/js/24.6ae343c9.js"><link rel="prefetch" href="/assets/js/25.e5d4db2a.js"><link rel="prefetch" href="/assets/js/26.49ddf5e0.js"><link rel="prefetch" href="/assets/js/27.8ea45a54.js"><link rel="prefetch" href="/assets/js/28.ccb2b926.js"><link rel="prefetch" href="/assets/js/29.2433cbcd.js"><link rel="prefetch" href="/assets/js/30.b11f80e9.js"><link rel="prefetch" href="/assets/js/31.81256fb7.js"><link rel="prefetch" href="/assets/js/32.2ff0c303.js"><link rel="prefetch" href="/assets/js/33.4ce9ddd1.js"><link rel="prefetch" href="/assets/js/34.03bffcee.js"><link rel="prefetch" href="/assets/js/35.f8a9a551.js"><link rel="prefetch" href="/assets/js/36.8520137a.js"><link rel="prefetch" href="/assets/js/37.d9c6f0fa.js"><link rel="prefetch" href="/assets/js/38.92b36679.js"><link rel="prefetch" href="/assets/js/39.b958e128.js"><link rel="prefetch" href="/assets/js/4.c4d02356.js"><link rel="prefetch" href="/assets/js/40.29108793.js"><link rel="prefetch" href="/assets/js/41.a6366543.js"><link rel="prefetch" href="/assets/js/42.8b148511.js"><link rel="prefetch" href="/assets/js/43.e1763fb1.js"><link rel="prefetch" href="/assets/js/44.88d180c5.js"><link rel="prefetch" href="/assets/js/45.14b10a7d.js"><link rel="prefetch" href="/assets/js/46.93e3c7d7.js"><link rel="prefetch" href="/assets/js/47.e048c8cd.js"><link rel="prefetch" href="/assets/js/48.c5f9b4e8.js"><link rel="prefetch" href="/assets/js/49.70bccd74.js"><link rel="prefetch" href="/assets/js/5.4e88fd54.js"><link rel="prefetch" href="/assets/js/50.73312e50.js"><link rel="prefetch" href="/assets/js/51.e3a23273.js"><link rel="prefetch" href="/assets/js/52.ac5850db.js"><link rel="prefetch" href="/assets/js/53.964975e2.js"><link rel="prefetch" href="/assets/js/54.f8d8e32f.js"><link rel="prefetch" href="/assets/js/55.adab5810.js"><link rel="prefetch" href="/assets/js/56.aa0168c6.js"><link rel="prefetch" href="/assets/js/57.74697c72.js"><link rel="prefetch" href="/assets/js/58.0e7e958f.js"><link rel="prefetch" href="/assets/js/59.ee99df0c.js"><link rel="prefetch" href="/assets/js/6.b8b20bba.js"><link rel="prefetch" href="/assets/js/60.c20c903c.js"><link rel="prefetch" href="/assets/js/61.74ebb11f.js"><link rel="prefetch" href="/assets/js/62.5d7a7e72.js"><link rel="prefetch" href="/assets/js/63.c62b52d3.js"><link rel="prefetch" href="/assets/js/64.7c77fdd3.js"><link rel="prefetch" href="/assets/js/65.cb59ccfd.js"><link rel="prefetch" href="/assets/js/66.a7c3f8b7.js"><link rel="prefetch" href="/assets/js/67.95703483.js"><link rel="prefetch" href="/assets/js/68.6b4aef53.js"><link rel="prefetch" href="/assets/js/69.d94ed977.js"><link rel="prefetch" href="/assets/js/7.03c52a18.js"><link rel="prefetch" href="/assets/js/70.30b89105.js"><link rel="prefetch" href="/assets/js/71.7fb0a32a.js"><link rel="prefetch" href="/assets/js/72.04d95023.js"><link rel="prefetch" href="/assets/js/73.2ff7a268.js"><link rel="prefetch" href="/assets/js/74.d5c20b17.js"><link rel="prefetch" href="/assets/js/75.93bb57ce.js"><link rel="prefetch" href="/assets/js/76.55eb3fc8.js"><link rel="prefetch" href="/assets/js/77.5f66661c.js"><link rel="prefetch" href="/assets/js/78.14d0f57b.js"><link rel="prefetch" href="/assets/js/79.669c7d06.js"><link rel="prefetch" href="/assets/js/8.a356396f.js"><link rel="prefetch" href="/assets/js/80.efcf2688.js"><link rel="prefetch" href="/assets/js/81.d2e10130.js"><link rel="prefetch" href="/assets/js/82.b8ec9c21.js"><link rel="prefetch" href="/assets/js/83.9f22d6f2.js"><link rel="prefetch" href="/assets/js/84.4d1a6f69.js"><link rel="prefetch" href="/assets/js/85.d0dbb86b.js"><link rel="prefetch" href="/assets/js/86.3aa72ece.js"><link rel="prefetch" href="/assets/js/87.54f22267.js"><link rel="prefetch" href="/assets/js/88.85b21d95.js"><link rel="prefetch" href="/assets/js/89.2e8b9c83.js"><link rel="prefetch" href="/assets/js/9.ab3eeae2.js"><link rel="prefetch" href="/assets/js/90.61a4bb62.js"><link rel="prefetch" href="/assets/js/91.fef73b59.js"><link rel="prefetch" href="/assets/js/92.aec6eac0.js"><link rel="prefetch" href="/assets/js/93.caab4000.js"><link rel="prefetch" href="/assets/js/94.a156da91.js"><link rel="prefetch" href="/assets/js/95.a8412a27.js"><link rel="prefetch" href="/assets/js/96.d38de525.js"><link rel="prefetch" href="/assets/js/97.ede060e4.js"><link rel="prefetch" href="/assets/js/98.40ba68d7.js"><link rel="prefetch" href="/assets/js/99.fd9d661c.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.21f21cd2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.75c9abf4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/mt-logo-small.png" alt="MassTransit" class="logo"> <span class="site-name can-hide">MassTransit</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/discord.html" class="nav-link">
  Discord
</a></div><div class="nav-item"><a href="https://nuget.org/packages/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/discord.html" class="nav-link">
  Discord
</a></div><div class="nav-item"><a href="https://nuget.org/packages/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/getting-started/" class="sidebar-heading clickable"><span>Getting Started</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/getting-started/live-coding.html" class="sidebar-link">Live Coding</a></li><li><a href="/getting-started/upgrade-v6.html" class="sidebar-link">Upgrading</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/releases/" class="sidebar-heading clickable"><span>Release Notes</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/usage/" class="sidebar-heading clickable router-link-active open"><span>Using MassTransit</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/usage/configuration.html" class="sidebar-link">Configuration</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/transports/" class="sidebar-heading clickable"><span>Transports</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/riders/" class="sidebar-heading clickable"><span>Riders</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/usage/mediator.html" class="sidebar-link">Mediator</a></li><li><a href="/usage/messages.html" aria-current="page" class="active sidebar-link">Messages</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/usage/messages.html#message-names" class="sidebar-link">Message Names</a></li><li class="sidebar-sub-header"><a href="/usage/messages.html#message-headers" class="sidebar-link">Message Headers</a></li><li class="sidebar-sub-header"><a href="/usage/messages.html#correlation" class="sidebar-link">Correlation</a></li><li class="sidebar-sub-header"><a href="/usage/messages.html#guidance" class="sidebar-link">Guidance</a></li></ul></li><li><a href="/usage/consumers.html" class="sidebar-link">Consumers</a></li><li><a href="/usage/producers.html" class="sidebar-link">Producers</a></li><li><a href="/usage/exceptions.html" class="sidebar-link">Exceptions</a></li><li><a href="/usage/requests.html" class="sidebar-link">Requests</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/sagas/" class="sidebar-heading clickable"><span>Sagas</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/containers/" class="sidebar-heading clickable"><span>Containers</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/usage/testing.html" class="sidebar-link">Testing</a></li><li><a href="/usage/logging.html" class="sidebar-link">Logging</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Advanced</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn/" class="sidebar-heading clickable"><span>Getting Help</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Articles</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/platform/" class="sidebar-heading clickable"><span>Platform</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Reference</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="messages"><a href="#messages" class="header-anchor">#</a> Messages</h1> <p>In MassTransit, a message contract is defined <em>code first</em> by creating a .NET type. A message can be defined using a class or an interface, resulting in a strongly-typed contract. Messages should be limited to read-only properties and not include methods or behavior.</p> <div class="custom-block warning"><p class="custom-block-title">Important</p> <p>MassTransit uses the full type name, including the <em>namespace</em>, for message contracts. When creating the same message <em>type</em> in two separate projects, the namespaces <strong>must</strong> match or the message will not be consumed.</p></div> <p>An example message to update a customer address is shown below.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code>	<span class="token keyword">namespace</span> <span class="token namespace">Company<span class="token punctuation">.</span>Application<span class="token punctuation">.</span>Contracts</span>
	<span class="token punctuation">{</span>
		<span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>

		<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UpdateCustomerAddress</span>
		<span class="token punctuation">{</span>
			<span class="token return-type class-name">Guid</span> CommandId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
			<span class="token return-type class-name">DateTime</span> Timestamp <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
			<span class="token return-type class-name"><span class="token keyword">string</span></span> CustomerId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
			<span class="token return-type class-name"><span class="token keyword">string</span></span> HouseNumber <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
			<span class="token return-type class-name"><span class="token keyword">string</span></span> Street <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
			<span class="token return-type class-name"><span class="token keyword">string</span></span> City <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
			<span class="token return-type class-name"><span class="token keyword">string</span></span> State <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
			<span class="token return-type class-name"><span class="token keyword">string</span></span> PostalCode <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>It is strongly suggested to use interfaces for message contracts, based on experience over several years with varying levels of developer experience. MassTransit will create dynamic interface implementations for the messages, ensuring a clean separation of the message contract from the consumer.</p></div> <p>A common mistake when engineers are new to messaging is to create a base class for messages, and try to dispatch that base class in the consumer – including the behavior of the subclass. Ouch. This always leads to pain and suffering, so just say no to base classes.</p> <h2 id="message-names"><a href="#message-names" class="header-anchor">#</a> Message Names</h2> <p>There are two main message types, <em>events</em> and <em>commands</em>. When choosing a name for a message, the type of message should dictate the tense of the message.</p> <h3 id="commands"><a href="#commands" class="header-anchor">#</a> Commands</h3> <p>A command tells a service to do something. Commands are <a href="/usage/producers.html#send">sent</a> (using <code>Send</code>) to an endpoint, as it is expected that a single service instance performs the command action. A command should never be published.</p> <p>Commands should be expressed in a verb-noun sequence, following the <em>tell</em> style.</p> <p>Example Commands:</p> <ul><li>UpdateCustomerAddress</li> <li>UpgradeCustomerAccount</li> <li>SubmitOrder</li></ul> <h3 id="events"><a href="#events" class="header-anchor">#</a> Events</h3> <p>An event signifies that something has happened. Events are <a href="/usage/producers.html#publish">published</a> (using <code>Publish</code>) via either <code>IBus</code> (standalone) or <code>ConsumeContext</code> (within a message consumer). An event should not be sent directly to an endpoint.</p> <p>Events should be expressed in a noun-verb (past tense) sequence, indicating that something happened.</p> <p>Example Events:</p> <ul><li>CustomerAddressUpdated</li> <li>CustomerAccountUpgraded</li> <li>OrderSubmitted, OrderAccepted, OrderRejected, OrderShipped</li></ul> <h2 id="message-headers"><a href="#message-headers" class="header-anchor">#</a> Message Headers</h2> <p>MassTransit encapsulates every sent or published message in a message envelope (described by the <a href="https://www.enterpriseintegrationpatterns.com/patterns/messaging/EnvelopeWrapper.html" target="_blank" rel="noopener noreferrer">Envelope Wrapper<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> pattern). The envelope adds a series of message headers, including:</p> <table><thead><tr><th style="text-align:left;">Property</th> <th style="text-align:center;">Type</th> <th style="text-align:left;">Description</th></tr></thead> <tbody><tr><td style="text-align:left;">MessageId</td> <td style="text-align:center;">Auto</td> <td style="text-align:left;">Generated for each message using <code>NewId.NextGuid</code>.</td></tr> <tr><td style="text-align:left;">CorrelationId</td> <td style="text-align:center;">User</td> <td style="text-align:left;">Assigned by the application, or automatically by convention, and should uniquely identify the operation, event, etc.</td></tr> <tr><td style="text-align:left;">RequestId</td> <td style="text-align:center;">Request</td> <td style="text-align:left;">Assigned by the request client, and automatically copied by the <em>Respond</em> methods to correlate responses to the original request.</td></tr> <tr><td style="text-align:left;">InitiatorId</td> <td style="text-align:center;">Auto</td> <td style="text-align:left;">Assigned when publishing or sending from a consumer, saga, or activity to the value of the <em>CorrelationId</em> on the consumed message.</td></tr> <tr><td style="text-align:left;">ConversationId</td> <td style="text-align:center;">Auto</td> <td style="text-align:left;">Assigned when the first message sent or published and no consumed message is available, ensuring that a set of messages within the same conversation have the save identifier.</td></tr> <tr><td style="text-align:left;">SourceAddress</td> <td style="text-align:center;">Auto</td> <td style="text-align:left;">Where the message originated (may be a temporary address for messages published or sent from <code>IBus</code>).</td></tr> <tr><td style="text-align:left;">DestinationAddress</td> <td style="text-align:center;">Auto</td> <td style="text-align:left;">Where the message was sent</td></tr> <tr><td style="text-align:left;">ResponseAddress</td> <td style="text-align:center;">Request</td> <td style="text-align:left;">Where responses to the request should be sent. If not present, responses are <em>published</em>.</td></tr> <tr><td style="text-align:left;">FaultAddress</td> <td style="text-align:center;">User</td> <td style="text-align:left;">Where consumer faults should be sent. If not present, faults are <em>published</em>.</td></tr> <tr><td style="text-align:left;">ExpirationTime</td> <td style="text-align:center;">User</td> <td style="text-align:left;">When the message should expire, which may be used by the transport to remove the message if it isn't consumed by the expiration time.</td></tr> <tr><td style="text-align:left;">SentTime</td> <td style="text-align:center;">Auto</td> <td style="text-align:left;">When the message was sent, in UTC.</td></tr> <tr><td style="text-align:left;">MessageType</td> <td style="text-align:center;">Auto</td> <td style="text-align:left;">An array of message types, in a <code>MessageUrn</code> format, which can be deserialized.</td></tr> <tr><td style="text-align:left;">Host</td> <td style="text-align:center;">Auto</td> <td style="text-align:left;">The host information of the machine that sent or published the message.</td></tr> <tr><td style="text-align:left;">Headers</td> <td style="text-align:center;">User</td> <td style="text-align:left;">Additional headers, which can be added by the user, middleware, or diagnostic trace filters.</td></tr></tbody></table> <p>Message headers can be read using the <code>ConsumeContext</code> interface and specified using the <code>SendContext</code> interface.</p> <h2 id="correlation"><a href="#correlation" class="header-anchor">#</a> Correlation</h2> <p>Messages are usually part of a conversation and identifiers are used to connect messages to that conversation. In the previous section, the headers supported by MassTransit, including <em>ConversationId</em>, <em>CorrelationId</em>, and <em>InitiatorId</em>, are used to combine separate messages into a conversation. Outbound messages that are published or sent by a consumer will have the same <em>ConversationId</em> as the consumed message. If the consumed message has a <em>CorrelationId</em>, that value will be copied to the <em>InitiatorId</em>. These headers capture the flow of messages involved in the conversation.</p> <p><em>CorrelationId</em> may be set, when appropriate, by the developer publishing or sending a message. <em>CorrelationId</em> can be set explicitly on the <em>PublishContext</em> or <em>SendContext</em> or when using a message initializer via the <em>__CorrelationId</em> property. The example below shows how either of these methods can be used.</p> <div class="language-cs extra-class"><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><div class="highlighted"> </div><br><br><br><br><br><br><br><br></div><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">UsageMessageCorrelation</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">UsageContracts</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> busControl <span class="token operator">=</span> Bus<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">CreateUsingRabbitMq</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">await</span> busControl<span class="token punctuation">.</span><span class="token function">StartAsync</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">CancellationTokenSource</span><span class="token punctuation">(</span>TimeSpan<span class="token punctuation">.</span><span class="token function">FromSeconds</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span>
            <span class="token punctuation">{</span>
                <span class="token class-name"><span class="token keyword">var</span></span> endpoint <span class="token operator">=</span> <span class="token keyword">await</span> busControl<span class="token punctuation">.</span><span class="token function">GetSendEndpoint</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span><span class="token string">&quot;queue:order-service&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// Set CorrelationId using SendContext&lt;T&gt;</span>
                <span class="token keyword">await</span> endpoint<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Send</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SubmitOrder<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{</span> OrderId <span class="token operator">=</span> InVar<span class="token punctuation">.</span>Id <span class="token punctuation">}</span><span class="token punctuation">,</span> context <span class="token operator">=&gt;</span>
                    context<span class="token punctuation">.</span>CorrelationId <span class="token operator">=</span> context<span class="token punctuation">.</span>Message<span class="token punctuation">.</span>OrderId<span class="token punctuation">)</span><span class="token punctuation">;</span>

                <span class="token comment">// Set CorrelationId using initializer header</span>
                <span class="token keyword">await</span> endpoint<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Send</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SubmitOrder<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span>
                <span class="token punctuation">{</span> 
                    OrderId <span class="token operator">=</span> InVar<span class="token punctuation">.</span>Id<span class="token punctuation">,</span>
                    __CorrelationId <span class="token operator">=</span> InVar<span class="token punctuation">.</span>Id

                    <span class="token comment">// InVar.Id returns the same value within the message initializer</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">finally</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">await</span> busControl<span class="token punctuation">.</span><span class="token function">StopAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><h3 id="correlation-conventions"><a href="#correlation-conventions" class="header-anchor">#</a> Correlation Conventions</h3> <p><em>CorrelationId</em> can also be set by convention. MassTransit includes several conventions by default, which may be used as the source to initialize the <em>CorrelationId</em> header.</p> <ol><li>If the message implements the <code>CorrelatedBy&lt;Guid&gt;</code> interface, which has a <code>Guid CorrelationId</code> property, its value will be used.</li> <li>If the message has a property named <em>CorrelationId</em>, <em>CommandId</em>, or <em>EventId</em> that is a <em>Guid</em> or <em>Guid?</em>, its value will be used.</li> <li>If the developer registered a <em>CorrelationId</em> provider for the message type, it will be used get the value.</li></ol> <p>The final convention requires the developer to register a <em>CorrelationId</em> provider prior to bus creation. The convention can be registered two ways, one of which is the new way, and the other which is the original approach that simply calls the new way. An example of the new approach, as well as the previous method, is shown below.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">UsageMessageSetCorrelation</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">UsageContracts</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">MassTransit<span class="token punctuation">.</span>Context</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">MassTransit<span class="token punctuation">.</span>Topology<span class="token punctuation">.</span>Topologies</span><span class="token punctuation">;</span>


    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Use the OrderId as the message CorrelationId</span>
            GlobalTopology<span class="token punctuation">.</span>Send<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">UseCorrelationId</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SubmitOrder<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>OrderId<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Previous approach, which now calls the new way above</span>
            MessageCorrelation<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">UseCorrelationId</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SubmitOrder<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>OrderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><p>The convention can also be specified during bus configuration, as shown. In this case, the convention applies to the configured bus instance. The previous approach was a global configuration shared by all bus instances.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token keyword">namespace</span> <span class="token namespace">UsageMessageSendCorrelation</span>
<span class="token punctuation">{</span>
    <span class="token keyword">using</span> <span class="token namespace">System</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Threading<span class="token punctuation">.</span>Tasks</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">UsageContracts</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token namespace">MassTransit</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Program</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> busControl <span class="token operator">=</span> Bus<span class="token punctuation">.</span>Factory<span class="token punctuation">.</span><span class="token function">CreateUsingRabbitMq</span><span class="token punctuation">(</span>cfg <span class="token operator">=&gt;</span>
            <span class="token punctuation">{</span>
                cfg<span class="token punctuation">.</span>SendTopology<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">UseCorrelationId</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SubmitOrder<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>OrderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div><p>Registering <em>CorrelationId</em> providers should be done early in the application, prior to bus configuration. An easy approach is putting the registration methods into a class method and calling it during application startup.</p> <h3 id="saga-correlation"><a href="#saga-correlation" class="header-anchor">#</a> Saga Correlation</h3> <p>Sagas <em>must</em> have a <em>CorrelationId</em>, it is the primary key used by the saga repository and the way messages are correlated to a specific saga instance. MassTransit follows the conventions above to obtain the <em>CorrelationId</em> used to create a new or load an existing saga instance. Newly created saga instances will be assigned the <em>CorrelationId</em> from the initiating message.</p> <div class="custom-block tip"><p class="custom-block-title">New in Version 7</p> <p>Previous versions of MassTransit only supported automatic correlation when the message implemented the <code>CorrelatedBy&lt;Guid&gt;</code> interface. Starting with Version 7, all of the above conventions are used.</p></div> <h3 id="identifiers"><a href="#identifiers" class="header-anchor">#</a> Identifiers</h3> <p>MassTransit uses and highly encourages the use of <em>Guid</em> identifiers. Distributed systems would crumble using monotonically incrementing identifiers (such as <em>int</em> or <em>long</em>) due to the bottleneck of locking and incrementing a shared counter. Historically, certain types (okay, we'll call them out - SQL DBAs) have argued against using <em>Guid</em> (or, their term, <em>uniqueidentifier</em>) as a key – a clustered primary key in particular. However, with MassTransit, we solved that problem.</p> <p>MassTransit uses <a href="https://www.nuget.org/packages/NewId" target="_blank" rel="noopener noreferrer">NewId<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to generate identifiers that are unique, sequential, and represented as a <em>Guid</em>. The generated identifiers are clustered-index friendly, and are ordered so that SQL Server can efficiently insert them into a database with the <em>uniqueidentifier</em> as the primary key.</p> <p>To create a <em>Guid</em>, call <code>NewId.NextGuid()</code> where you would otherwise call <code>Guid.NewGuid()</code> – and start enjoying the benefits of fast, distributed identifiers.</p> <h2 id="guidance"><a href="#guidance" class="header-anchor">#</a> Guidance</h2> <p>When defining message contracts, what follows is general guidance based upon years of using MassTransit combined with continued questions raised by developers new to MassTransit.</p> <ul><li>Use interfaces and message initializers. Once you adjust it starts to make more sense. Use the Roslyn Analyzer to identify missing or incompatible property initializers.
<ul><li>Inheritance is okay, but keep it sensible as the type hierarchy will be applied to the broker. A message type containing a dozen interfaces is a bit annoying to untangle if you need to delve deep into message routing to troubleshoot an issue.</li></ul></li> <li>Class inheritance has the same guidance as interfaces, but with more caution.
<ul><li>Consuming a base class type, and expecting polymorphic method behavior almost always leads to problems.</li> <li>Message design is not object-oriented design. Messages should contain state, not behavior. Behavior should be in a separate class or service.</li> <li>A big base class may cause pain down the road as changes are made, particularly when supporting multiple message versions.</li></ul></li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/MassTransit/MassTransit/edit/develop/docs/usage/messages.md" target="_blank" rel="noopener noreferrer">Help us by improving this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/23/2020, 12:53:00 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/usage/mediator.html" class="prev">
        Mediator
      </a></span> <span class="next"><a href="/usage/consumers.html">
        Consumers
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.195ff7db.js" defer></script><script src="/assets/js/3.49f501da.js" defer></script><script src="/assets/js/121.bf5544df.js" defer></script>
  </body>
</html>
