<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Requests | MassTransit</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#3a0839">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="description" content="A free, open-source distributed application framework for .NET.">
    <meta name="msapplication-TileColor" content="#3a0839">
    <meta name="msapplication-config" content="/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/assets/css/0.styles.75c9abf4.css" as="style"><link rel="preload" href="/assets/js/app.195ff7db.js" as="script"><link rel="preload" href="/assets/js/3.49f501da.js" as="script"><link rel="preload" href="/assets/js/124.39757413.js" as="script"><link rel="prefetch" href="/assets/js/10.a0cd44ab.js"><link rel="prefetch" href="/assets/js/100.9feb174f.js"><link rel="prefetch" href="/assets/js/101.f3afae1f.js"><link rel="prefetch" href="/assets/js/102.edc3cfd3.js"><link rel="prefetch" href="/assets/js/103.396b5261.js"><link rel="prefetch" href="/assets/js/104.35ef931e.js"><link rel="prefetch" href="/assets/js/105.75295f36.js"><link rel="prefetch" href="/assets/js/106.c42d7948.js"><link rel="prefetch" href="/assets/js/107.4cddb7d4.js"><link rel="prefetch" href="/assets/js/108.6d56d230.js"><link rel="prefetch" href="/assets/js/109.3a2c9c0e.js"><link rel="prefetch" href="/assets/js/11.3d40bd0b.js"><link rel="prefetch" href="/assets/js/110.c4aa15ea.js"><link rel="prefetch" href="/assets/js/111.c661ab49.js"><link rel="prefetch" href="/assets/js/112.0f444d04.js"><link rel="prefetch" href="/assets/js/113.b7745232.js"><link rel="prefetch" href="/assets/js/114.1f4ecadb.js"><link rel="prefetch" href="/assets/js/115.6acc0049.js"><link rel="prefetch" href="/assets/js/116.59b4c1e7.js"><link rel="prefetch" href="/assets/js/117.0089265d.js"><link rel="prefetch" href="/assets/js/118.dee3db3a.js"><link rel="prefetch" href="/assets/js/119.c2dd72f1.js"><link rel="prefetch" href="/assets/js/12.67901ed9.js"><link rel="prefetch" href="/assets/js/120.2f521996.js"><link rel="prefetch" href="/assets/js/121.bf5544df.js"><link rel="prefetch" href="/assets/js/122.f63abbe1.js"><link rel="prefetch" href="/assets/js/123.d34457fe.js"><link rel="prefetch" href="/assets/js/125.5ae9566e.js"><link rel="prefetch" href="/assets/js/126.73bcf6ec.js"><link rel="prefetch" href="/assets/js/127.3d4534d5.js"><link rel="prefetch" href="/assets/js/128.c47aea17.js"><link rel="prefetch" href="/assets/js/129.e6499def.js"><link rel="prefetch" href="/assets/js/13.773b7e4f.js"><link rel="prefetch" href="/assets/js/130.30e02611.js"><link rel="prefetch" href="/assets/js/131.371a8da4.js"><link rel="prefetch" href="/assets/js/132.f5ff377c.js"><link rel="prefetch" href="/assets/js/133.edee58ae.js"><link rel="prefetch" href="/assets/js/134.40abac7e.js"><link rel="prefetch" href="/assets/js/135.7b10e613.js"><link rel="prefetch" href="/assets/js/136.6c4a4c9e.js"><link rel="prefetch" href="/assets/js/137.898fd9a1.js"><link rel="prefetch" href="/assets/js/138.c6591b9d.js"><link rel="prefetch" href="/assets/js/139.27a7976e.js"><link rel="prefetch" href="/assets/js/14.162fd7de.js"><link rel="prefetch" href="/assets/js/140.8f5fbf89.js"><link rel="prefetch" href="/assets/js/141.d2c4074e.js"><link rel="prefetch" href="/assets/js/142.ca465ae2.js"><link rel="prefetch" href="/assets/js/143.74deca00.js"><link rel="prefetch" href="/assets/js/144.70d74a91.js"><link rel="prefetch" href="/assets/js/145.6b2b56f8.js"><link rel="prefetch" href="/assets/js/146.f192058f.js"><link rel="prefetch" href="/assets/js/147.2dd1eca6.js"><link rel="prefetch" href="/assets/js/148.63cb766b.js"><link rel="prefetch" href="/assets/js/149.ecc8a933.js"><link rel="prefetch" href="/assets/js/15.5698f0da.js"><link rel="prefetch" href="/assets/js/150.4b4c3db8.js"><link rel="prefetch" href="/assets/js/16.5359a736.js"><link rel="prefetch" href="/assets/js/17.e09dee46.js"><link rel="prefetch" href="/assets/js/18.89fe105c.js"><link rel="prefetch" href="/assets/js/19.0ba8fb0f.js"><link rel="prefetch" href="/assets/js/20.a337dd2d.js"><link rel="prefetch" href="/assets/js/21.93618127.js"><link rel="prefetch" href="/assets/js/22.2956ed34.js"><link rel="prefetch" href="/assets/js/23.e7e073ac.js"><link rel="prefetch" href="/assets/js/24.6ae343c9.js"><link rel="prefetch" href="/assets/js/25.e5d4db2a.js"><link rel="prefetch" href="/assets/js/26.49ddf5e0.js"><link rel="prefetch" href="/assets/js/27.8ea45a54.js"><link rel="prefetch" href="/assets/js/28.ccb2b926.js"><link rel="prefetch" href="/assets/js/29.2433cbcd.js"><link rel="prefetch" href="/assets/js/30.b11f80e9.js"><link rel="prefetch" href="/assets/js/31.81256fb7.js"><link rel="prefetch" href="/assets/js/32.2ff0c303.js"><link rel="prefetch" href="/assets/js/33.4ce9ddd1.js"><link rel="prefetch" href="/assets/js/34.03bffcee.js"><link rel="prefetch" href="/assets/js/35.f8a9a551.js"><link rel="prefetch" href="/assets/js/36.8520137a.js"><link rel="prefetch" href="/assets/js/37.d9c6f0fa.js"><link rel="prefetch" href="/assets/js/38.92b36679.js"><link rel="prefetch" href="/assets/js/39.b958e128.js"><link rel="prefetch" href="/assets/js/4.c4d02356.js"><link rel="prefetch" href="/assets/js/40.29108793.js"><link rel="prefetch" href="/assets/js/41.a6366543.js"><link rel="prefetch" href="/assets/js/42.8b148511.js"><link rel="prefetch" href="/assets/js/43.e1763fb1.js"><link rel="prefetch" href="/assets/js/44.88d180c5.js"><link rel="prefetch" href="/assets/js/45.14b10a7d.js"><link rel="prefetch" href="/assets/js/46.93e3c7d7.js"><link rel="prefetch" href="/assets/js/47.e048c8cd.js"><link rel="prefetch" href="/assets/js/48.c5f9b4e8.js"><link rel="prefetch" href="/assets/js/49.70bccd74.js"><link rel="prefetch" href="/assets/js/5.4e88fd54.js"><link rel="prefetch" href="/assets/js/50.73312e50.js"><link rel="prefetch" href="/assets/js/51.e3a23273.js"><link rel="prefetch" href="/assets/js/52.ac5850db.js"><link rel="prefetch" href="/assets/js/53.964975e2.js"><link rel="prefetch" href="/assets/js/54.f8d8e32f.js"><link rel="prefetch" href="/assets/js/55.adab5810.js"><link rel="prefetch" href="/assets/js/56.aa0168c6.js"><link rel="prefetch" href="/assets/js/57.74697c72.js"><link rel="prefetch" href="/assets/js/58.0e7e958f.js"><link rel="prefetch" href="/assets/js/59.ee99df0c.js"><link rel="prefetch" href="/assets/js/6.b8b20bba.js"><link rel="prefetch" href="/assets/js/60.c20c903c.js"><link rel="prefetch" href="/assets/js/61.74ebb11f.js"><link rel="prefetch" href="/assets/js/62.5d7a7e72.js"><link rel="prefetch" href="/assets/js/63.c62b52d3.js"><link rel="prefetch" href="/assets/js/64.7c77fdd3.js"><link rel="prefetch" href="/assets/js/65.cb59ccfd.js"><link rel="prefetch" href="/assets/js/66.a7c3f8b7.js"><link rel="prefetch" href="/assets/js/67.95703483.js"><link rel="prefetch" href="/assets/js/68.6b4aef53.js"><link rel="prefetch" href="/assets/js/69.d94ed977.js"><link rel="prefetch" href="/assets/js/7.03c52a18.js"><link rel="prefetch" href="/assets/js/70.30b89105.js"><link rel="prefetch" href="/assets/js/71.7fb0a32a.js"><link rel="prefetch" href="/assets/js/72.04d95023.js"><link rel="prefetch" href="/assets/js/73.2ff7a268.js"><link rel="prefetch" href="/assets/js/74.d5c20b17.js"><link rel="prefetch" href="/assets/js/75.93bb57ce.js"><link rel="prefetch" href="/assets/js/76.55eb3fc8.js"><link rel="prefetch" href="/assets/js/77.5f66661c.js"><link rel="prefetch" href="/assets/js/78.14d0f57b.js"><link rel="prefetch" href="/assets/js/79.669c7d06.js"><link rel="prefetch" href="/assets/js/8.a356396f.js"><link rel="prefetch" href="/assets/js/80.efcf2688.js"><link rel="prefetch" href="/assets/js/81.d2e10130.js"><link rel="prefetch" href="/assets/js/82.b8ec9c21.js"><link rel="prefetch" href="/assets/js/83.9f22d6f2.js"><link rel="prefetch" href="/assets/js/84.4d1a6f69.js"><link rel="prefetch" href="/assets/js/85.d0dbb86b.js"><link rel="prefetch" href="/assets/js/86.3aa72ece.js"><link rel="prefetch" href="/assets/js/87.54f22267.js"><link rel="prefetch" href="/assets/js/88.85b21d95.js"><link rel="prefetch" href="/assets/js/89.2e8b9c83.js"><link rel="prefetch" href="/assets/js/9.ab3eeae2.js"><link rel="prefetch" href="/assets/js/90.61a4bb62.js"><link rel="prefetch" href="/assets/js/91.fef73b59.js"><link rel="prefetch" href="/assets/js/92.aec6eac0.js"><link rel="prefetch" href="/assets/js/93.caab4000.js"><link rel="prefetch" href="/assets/js/94.a156da91.js"><link rel="prefetch" href="/assets/js/95.a8412a27.js"><link rel="prefetch" href="/assets/js/96.d38de525.js"><link rel="prefetch" href="/assets/js/97.ede060e4.js"><link rel="prefetch" href="/assets/js/98.40ba68d7.js"><link rel="prefetch" href="/assets/js/99.fd9d661c.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.21f21cd2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.75c9abf4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/mt-logo-small.png" alt="MassTransit" class="logo"> <span class="site-name can-hide">MassTransit</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/discord.html" class="nav-link">
  Discord
</a></div><div class="nav-item"><a href="https://nuget.org/packages/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/discord.html" class="nav-link">
  Discord
</a></div><div class="nav-item"><a href="https://nuget.org/packages/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/getting-started/" class="sidebar-heading clickable"><span>Getting Started</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/getting-started/live-coding.html" class="sidebar-link">Live Coding</a></li><li><a href="/getting-started/upgrade-v6.html" class="sidebar-link">Upgrading</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/releases/" class="sidebar-heading clickable"><span>Release Notes</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/usage/" class="sidebar-heading clickable router-link-active open"><span>Using MassTransit</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/usage/configuration.html" class="sidebar-link">Configuration</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/transports/" class="sidebar-heading clickable"><span>Transports</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/riders/" class="sidebar-heading clickable"><span>Riders</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/usage/mediator.html" class="sidebar-link">Mediator</a></li><li><a href="/usage/messages.html" class="sidebar-link">Messages</a></li><li><a href="/usage/consumers.html" class="sidebar-link">Consumers</a></li><li><a href="/usage/producers.html" class="sidebar-link">Producers</a></li><li><a href="/usage/exceptions.html" class="sidebar-link">Exceptions</a></li><li><a href="/usage/requests.html" aria-current="page" class="active sidebar-link">Requests</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/usage/requests.html#request-consumer" class="sidebar-link">Request Consumer</a></li><li class="sidebar-sub-header"><a href="/usage/requests.html#request-client" class="sidebar-link">Request Client</a></li><li class="sidebar-sub-header"><a href="/usage/requests.html#container-configuration" class="sidebar-link">Container Configuration</a></li><li class="sidebar-sub-header"><a href="/usage/requests.html#multiple-requests" class="sidebar-link">Multiple Requests</a></li><li class="sidebar-sub-header"><a href="/usage/requests.html#multiple-response-types" class="sidebar-link">Multiple Response Types</a></li></ul></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/sagas/" class="sidebar-heading clickable"><span>Sagas</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/containers/" class="sidebar-heading clickable"><span>Containers</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/usage/testing.html" class="sidebar-link">Testing</a></li><li><a href="/usage/logging.html" class="sidebar-link">Logging</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Advanced</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn/" class="sidebar-heading clickable"><span>Getting Help</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Articles</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/platform/" class="sidebar-heading clickable"><span>Platform</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Reference</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="requests"><a href="#requests" class="header-anchor">#</a> Requests</h1> <p>Request/response is a common pattern in application development, where a component sends a request to a service and continues once the response is received. In a distributed system, this can increase the latency of an application since the service may be hosted in another process, on another machine, or may even be a remote service in another network. While in many cases it is best to avoid request/response use in distributed applications, particularly when the request is a command, it is often necessary and preferred over more complex solutions.</p> <p>Fortunately for .NET developers, C# with TPL makes it easier to program applications that call services asynchronously. By using <em>Tasks</em> and the <em>async</em> and <em>await</em> keywords, developers can write procedural code and avoid the complex use of callbacks and handlers. Additionally, multiple asynchronous requests can be executed at once, reducing the overall execution time to that of the longest request.</p> <h3 id="message-contracts"><a href="#message-contracts" class="header-anchor">#</a> Message Contracts</h3> <p>To get started, the message contracts need to be created. In this example, an order status check is being created.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">CheckOrderStatus</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> OrderId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderStatusResult</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> OrderId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token return-type class-name">DateTime</span> Timestamp <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token return-type class-name"><span class="token keyword">short</span></span> StatusCode <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token return-type class-name"><span class="token keyword">string</span></span> StatusText <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="request-consumer"><a href="#request-consumer" class="header-anchor">#</a> Request Consumer</h2> <p>In order for the request to return anything, it needs to be handled. Handling requests is done by using normal consumers. The only difference is that such consumer needs to send a response back.</p> <p>For the aforementioned message contracts, the request handler can look like this:</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CheckOrderStatusConsumer</span> <span class="token punctuation">:</span> 
    <span class="token type-list"><span class="token class-name">IConsumer<span class="token punctuation">&lt;</span>CheckOrderStatus<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">readonly</span> <span class="token class-name">IOrderRepository</span> _orderRepository<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">CheckOrderStatusConsumer</span><span class="token punctuation">(</span><span class="token class-name">IOrderRepository</span> orderRepository<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _orderRepository <span class="token operator">=</span> orderRepository<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Consume</span><span class="token punctuation">(</span><span class="token class-name">ConsumeContext<span class="token punctuation">&lt;</span>CheckOrderStatus<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> order <span class="token operator">=</span> <span class="token keyword">await</span> _orderRepository<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Message<span class="token punctuation">.</span>OrderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>order <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">InvalidOperationException</span><span class="token punctuation">(</span><span class="token string">&quot;Order not found&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">await</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RespondAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OrderStatusResult<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> 
        <span class="token punctuation">{</span>
            OrderId <span class="token operator">=</span> order<span class="token punctuation">.</span>Id<span class="token punctuation">,</span>
            order<span class="token punctuation">.</span>Timestamp<span class="token punctuation">,</span>
            order<span class="token punctuation">.</span>StatusCode<span class="token punctuation">,</span>
            order<span class="token punctuation">.</span>StatusText
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The response will be sent back to the requester. In case the exception is thrown, MassTransit will create a <code>Fault&lt;CheckOrderStatus&gt;</code> message and send it back to the requester. The requester address is available in the consume context of the request message as <code>context.ResponseAddress</code>.</p> <h2 id="request-client"><a href="#request-client" class="header-anchor">#</a> Request Client</h2> <p>Most interactions of the request/response nature consist of four elements: the request arguments, the response values, exception handling, and the time to wait for a response. The .NET framework gives us one additional element, a <code>CancellationToken</code> which can prematurely cancel waiting for the response.</p> <p>In MassTransit, the request client is composed of two parts, a client factory, and a request client. The client factory is created from the bus, or a connected endpoint, and has the interface below (some overloads are omitted, but you get the idea).</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IClientFactory</span> 
<span class="token punctuation">{</span>
    <span class="token return-type class-name">IRequestClient<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">CreateRequestClient</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">ConsumeContext</span> context<span class="token punctuation">,</span> <span class="token class-name">Uri</span> destinationAddress<span class="token punctuation">,</span> <span class="token class-name">RequestTimeout</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token return-type class-name">IRequestClient<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">CreateRequestClient</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">Uri</span> destinationAddress<span class="token punctuation">,</span> <span class="token class-name">RequestTimeout</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token return-type class-name">RequestHandle<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">CreateRequest</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">T</span> request<span class="token punctuation">,</span> <span class="token class-name">Uri</span> destinationAddress<span class="token punctuation">,</span> <span class="token class-name">CancellationToken</span> cancellationToken<span class="token punctuation">,</span> <span class="token class-name">RequestTimeout</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token return-type class-name">RequestHandle<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">CreateRequest</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">ConsumeContext</span> context<span class="token punctuation">,</span> <span class="token class-name">T</span> request<span class="token punctuation">,</span> <span class="token class-name">Uri</span> destinationAddress<span class="token punctuation">,</span> <span class="token class-name">CancellationToken</span> cancellationToken<span class="token punctuation">,</span> <span class="token class-name">RequestTimeout</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>As shown, the client factory can create a request client, or it can create a request directly. There are advantages to each approach, although it's typically best to create a request client and use it if possible. If a consumer is sending the request, a new client should be created for each message (and is handled automatically if you're using a dependency injection container and the container registration methods).</p> <p>To create a client factory, call <code>bus.CreateClientFactory</code> or <code>host.CreateClientFactory</code> -- after the bus has been started.</p> <p>The request client can be used to create requests (returning a <code>RequestHandle&lt;T&gt;</code>, which must be disposed after the request completes) or it can be used directly to send a request and get a response (asynchronously, of course).</p> <blockquote><p>Using <code>Create</code> returns a request handle, which can be used to set headers and other attributes of the request before it is sent.</p></blockquote> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IRequestClient<span class="token punctuation">&lt;</span>TRequest<span class="token punctuation">&gt;</span></span>
    <span class="token keyword">where</span> <span class="token class-name">TRequest</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token keyword">class</span></span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name">RequestHandle<span class="token punctuation">&lt;</span>TRequest<span class="token punctuation">&gt;</span></span> <span class="token function">Create</span><span class="token punctuation">(</span><span class="token class-name">TRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">CancellationToken</span> cancellationToken<span class="token punctuation">,</span> <span class="token class-name">RequestTimeout</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>Response<span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> <span class="token generic-method"><span class="token function">GetResponse</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token class-name">TRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">CancellationToken</span> cancellationToken<span class="token punctuation">,</span> <span class="token class-name">RequestTimeout</span> timeout<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="sending-a-request"><a href="#sending-a-request" class="header-anchor">#</a> Sending a Request</h3> <p>To create a request client, and use it to make a standalone request (not from a consumer, API controller, etc.):</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> serviceAddress <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Uri</span><span class="token punctuation">(</span><span class="token string">&quot;rabbitmq://localhost/check-order-status&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> client <span class="token operator">=</span> bus<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">CreateRequestClient</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CheckOrderStatus<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>serviceAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetResponse</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OrderStatusResult<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{</span> OrderId <span class="token operator">=</span> id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The response type, <code>Response&lt;OrderStatusResult&gt;</code> includes the <em>MessageContext</em> from when the response was received, providing access to the message properties (such as <code>response.ConversationId</code>) and headers (<code>response.Headers</code>).</p> <p>To create a request, and add a header to the <code>SendContext</code>, use the <em>Create</em> method which returns a <em>RequestHandle</em> and then set the header using an execute filter as shown.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">var</span></span> request <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{</span> OrderId <span class="token operator">=</span> id<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    request<span class="token punctuation">.</span><span class="token function">UseExecute</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Headers<span class="token punctuation">.</span><span class="token function">Set</span><span class="token punctuation">(</span><span class="token string">&quot;custom-header&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;some-value&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> request<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetResponse</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OrderStatusResult<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Calling the <code>GetResponse</code> method triggers the request to be sent, after which the caller awaits the response. To add additional response types, see below for the tuple syntax, or just add multiple <code>GetResponse</code> methods, passing <em>false</em> for the <em>readyToSend</em> parameter.</p> <p>See below for examples of how to use the request client in different contexts.</p> <div class="custom-block warning"><p class="custom-block-title">IMPORTANT</p> <p>MassTransit uses a temporary non-durable queue and has a consumer to handle responses. This temporary queue only get configured and created when you <em>start the bus</em>. If you forget to start the bus in your application code, the request client will fail with a timeout, waiting for a response.</p></div> <h2 id="container-configuration"><a href="#container-configuration" class="header-anchor">#</a> Container Configuration</h2> <p>To register a request client for use with ASP.NET Core, it is recommended to use the <a href="https://www.nuget.org/packages/MassTransit.Extensions.DependencyInjection/" target="_blank" rel="noopener noreferrer">MassTransit.ExtensionsDependencyInjection<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> NuGet package. It can be used to setup ASP.NET to use MassTransit, and has registration methods to ensure consumers and request clients are properly registered.</p> <p>To configure the request client in ASP.NET, use the registration extension shown.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">ConfigureServices</span><span class="token punctuation">(</span><span class="token class-name">IServiceCollection</span> services<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    services<span class="token punctuation">.</span><span class="token function">AddMassTransit</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        x<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddConsumer</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CheckOrderStatusConsumer<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        x<span class="token punctuation">.</span><span class="token function">UsingInMemory</span><span class="token punctuation">(</span>cfg <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            cfg<span class="token punctuation">.</span><span class="token function">ConfigureEndpoints</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        x<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddRequestClient</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>CheckOrderStatus<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Once registered, a controller can use the client via a constructor dependency.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RequestController</span> <span class="token punctuation">:</span>
    <span class="token type-list"><span class="token class-name">Controller</span></span>
<span class="token punctuation">{</span>
    <span class="token class-name">IRequestClient<span class="token punctuation">&lt;</span>CheckOrderStatus<span class="token punctuation">&gt;</span></span> _client<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">RequestController</span><span class="token punctuation">(</span><span class="token class-name">IRequestClient<span class="token punctuation">&lt;</span>CheckOrderStatus<span class="token punctuation">&gt;</span></span> client<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _client <span class="token operator">=</span> client<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ActionResult<span class="token punctuation">&gt;</span></span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> id<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> _client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetResponse</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OrderStatusResult<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{</span>OrderId <span class="token operator">=</span> id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The controller method will send the command, and return the view once the result has been received.</p> <h2 id="multiple-requests"><a href="#multiple-requests" class="header-anchor">#</a> Multiple Requests</h2> <p>If there were multiple requests to be performed, it is easy to wait on all results at the same time, benefiting from the concurrent operation.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RequestController</span> <span class="token punctuation">:</span> 
    <span class="token type-list"><span class="token class-name">Controller</span></span>
<span class="token punctuation">{</span>
    <span class="token class-name">IRequestClient<span class="token punctuation">&lt;</span>RequestA<span class="token punctuation">&gt;</span></span> _clientA<span class="token punctuation">;</span>
    <span class="token class-name">IRequestClient<span class="token punctuation">&lt;</span>RequestB<span class="token punctuation">&gt;</span></span> _clientB<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">RequestController</span><span class="token punctuation">(</span><span class="token class-name">IRequestClient<span class="token punctuation">&lt;</span>RequestA<span class="token punctuation">&gt;</span></span> clientA<span class="token punctuation">,</span> <span class="token class-name">IRequestClient<span class="token punctuation">&lt;</span>RequestB<span class="token punctuation">&gt;</span></span> clientB<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        _clientA <span class="token operator">=</span> clientA<span class="token punctuation">;</span>
        _clientB <span class="token operator">=</span> clientB<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task<span class="token punctuation">&lt;</span>ActionResult<span class="token punctuation">&gt;</span></span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> resultA <span class="token operator">=</span> _clientA<span class="token punctuation">.</span><span class="token function">GetResponse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">RequestA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> resultB <span class="token operator">=</span> _clientB<span class="token punctuation">.</span><span class="token function">GetResponse</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">RequestB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">await</span> Task<span class="token punctuation">.</span><span class="token function">WhenAll</span><span class="token punctuation">(</span>resultA<span class="token punctuation">,</span> resultB<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name"><span class="token keyword">var</span></span> a <span class="token operator">=</span> <span class="token keyword">await</span> resultA<span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">var</span></span> b <span class="token operator">=</span> <span class="token keyword">await</span> resultB<span class="token punctuation">;</span>

        <span class="token class-name"><span class="token keyword">var</span></span> model <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Model</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> b<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token function">View</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The power of concurrency, for the win!</p> <h2 id="multiple-response-types"><a href="#multiple-response-types" class="header-anchor">#</a> Multiple Response Types</h2> <p>Another powerful feature with the request client is the ability support multiple (such as positive and negative) result types. For example, adding an <code>OrderNotFound</code> response type to the consumer as shown eliminates throwing an exception since a missing order isn't really a fault.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CheckOrderStatusConsumer</span> <span class="token punctuation">:</span> 
    <span class="token type-list"><span class="token class-name">IConsumer<span class="token punctuation">&lt;</span>CheckOrderStatus<span class="token punctuation">&gt;</span></span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">async</span> <span class="token return-type class-name">Task</span> <span class="token function">Consume</span><span class="token punctuation">(</span><span class="token class-name">ConsumeContext<span class="token punctuation">&lt;</span>CheckOrderStatus<span class="token punctuation">&gt;</span></span> context<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token class-name"><span class="token keyword">var</span></span> order <span class="token operator">=</span> <span class="token keyword">await</span> _orderRepository<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Message<span class="token punctuation">.</span>OrderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>order <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">await</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RespondAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OrderNotFound<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>        
            <span class="token keyword">await</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RespondAsync</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OrderStatusResult<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> 
            <span class="token punctuation">{</span>
                OrderId <span class="token operator">=</span> order<span class="token punctuation">.</span>Id<span class="token punctuation">,</span>
                order<span class="token punctuation">.</span>Timestamp<span class="token punctuation">,</span>
                order<span class="token punctuation">.</span>StatusCode<span class="token punctuation">,</span>
                order<span class="token punctuation">.</span>StatusText
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The client can now wait for multiple response types (in this case, two) by using a little tuple magic.</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetResponse</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OrderStatusResult<span class="token punctuation">,</span> OrderNotFound<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{</span> OrderId <span class="token operator">=</span> id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">Is</span><span class="token punctuation">(</span><span class="token keyword">out</span> <span class="token class-name">Response<span class="token punctuation">&lt;</span>OrderStatusResult<span class="token punctuation">&gt;</span></span> responseA<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// do something with the order</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">Is</span><span class="token punctuation">(</span><span class="token keyword">out</span> <span class="token class-name">Response<span class="token punctuation">&lt;</span>OrderNotFound<span class="token punctuation">&gt;</span></span> responseB<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// the order was not found</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This cleans up the processing, an eliminates the need to catch a <code>RequestFaultException</code>.</p> <p>It's also possible to use some of the switch expressions via deconstruction, but this requires the response variable to be explicitly specified as <code>Response</code>.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token class-name">Response</span> response <span class="token operator">=</span> <span class="token keyword">await</span> client<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetResponse</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>OrderStatusResult<span class="token punctuation">,</span> OrderNotFound<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token punctuation">{</span> OrderId <span class="token operator">=</span> id<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Using a regular switch statement</span>
<span class="token keyword">switch</span> <span class="token punctuation">(</span>response<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token class-name">OrderStatusResult</span> a<span class="token punctuation">)</span> responseA<span class="token punctuation">:</span>
        <span class="token comment">// order found</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
    <span class="token keyword">case</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token class-name">OrderNotFound</span> b<span class="token punctuation">)</span> responseB<span class="token punctuation">:</span>
        <span class="token comment">// order not found</span>
        <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Or using a switch expression</span>
<span class="token class-name"><span class="token keyword">var</span></span> accepted <span class="token operator">=</span> response <span class="token keyword">switch</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token class-name">OrderStatusResult</span> a<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token class-name">OrderNotFound</span> b<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    _ <span class="token operator">=&gt;</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">InvalidOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/MassTransit/MassTransit/edit/develop/docs/usage/requests.md" target="_blank" rel="noopener noreferrer">Help us by improving this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/22/2021, 6:45:51 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/usage/exceptions.html" class="prev">
        Exceptions
      </a></span> <span class="next"><a href="/usage/sagas/automatonymous.html">
        Automatonymous
      </a>
      
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.195ff7db.js" defer></script><script src="/assets/js/3.49f501da.js" defer></script><script src="/assets/js/124.39757413.js" defer></script>
  </body>
</html>
