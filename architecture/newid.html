<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>NewId | MassTransit</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#3a0839">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="description" content="A free, open-source distributed application framework for .NET.">
    <meta name="msapplication-TileColor" content="#3a0839">
    <meta name="msapplication-config" content="/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/assets/css/0.styles.75c9abf4.css" as="style"><link rel="preload" href="/assets/js/app.195ff7db.js" as="script"><link rel="preload" href="/assets/js/3.49f501da.js" as="script"><link rel="preload" href="/assets/js/65.cb59ccfd.js" as="script"><link rel="prefetch" href="/assets/js/10.a0cd44ab.js"><link rel="prefetch" href="/assets/js/100.9feb174f.js"><link rel="prefetch" href="/assets/js/101.f3afae1f.js"><link rel="prefetch" href="/assets/js/102.edc3cfd3.js"><link rel="prefetch" href="/assets/js/103.396b5261.js"><link rel="prefetch" href="/assets/js/104.35ef931e.js"><link rel="prefetch" href="/assets/js/105.75295f36.js"><link rel="prefetch" href="/assets/js/106.c42d7948.js"><link rel="prefetch" href="/assets/js/107.4cddb7d4.js"><link rel="prefetch" href="/assets/js/108.6d56d230.js"><link rel="prefetch" href="/assets/js/109.3a2c9c0e.js"><link rel="prefetch" href="/assets/js/11.3d40bd0b.js"><link rel="prefetch" href="/assets/js/110.c4aa15ea.js"><link rel="prefetch" href="/assets/js/111.c661ab49.js"><link rel="prefetch" href="/assets/js/112.0f444d04.js"><link rel="prefetch" href="/assets/js/113.b7745232.js"><link rel="prefetch" href="/assets/js/114.1f4ecadb.js"><link rel="prefetch" href="/assets/js/115.6acc0049.js"><link rel="prefetch" href="/assets/js/116.59b4c1e7.js"><link rel="prefetch" href="/assets/js/117.0089265d.js"><link rel="prefetch" href="/assets/js/118.dee3db3a.js"><link rel="prefetch" href="/assets/js/119.c2dd72f1.js"><link rel="prefetch" href="/assets/js/12.67901ed9.js"><link rel="prefetch" href="/assets/js/120.2f521996.js"><link rel="prefetch" href="/assets/js/121.bf5544df.js"><link rel="prefetch" href="/assets/js/122.f63abbe1.js"><link rel="prefetch" href="/assets/js/123.d34457fe.js"><link rel="prefetch" href="/assets/js/124.39757413.js"><link rel="prefetch" href="/assets/js/125.5ae9566e.js"><link rel="prefetch" href="/assets/js/126.73bcf6ec.js"><link rel="prefetch" href="/assets/js/127.3d4534d5.js"><link rel="prefetch" href="/assets/js/128.c47aea17.js"><link rel="prefetch" href="/assets/js/129.e6499def.js"><link rel="prefetch" href="/assets/js/13.773b7e4f.js"><link rel="prefetch" href="/assets/js/130.30e02611.js"><link rel="prefetch" href="/assets/js/131.371a8da4.js"><link rel="prefetch" href="/assets/js/132.f5ff377c.js"><link rel="prefetch" href="/assets/js/133.edee58ae.js"><link rel="prefetch" href="/assets/js/134.40abac7e.js"><link rel="prefetch" href="/assets/js/135.7b10e613.js"><link rel="prefetch" href="/assets/js/136.6c4a4c9e.js"><link rel="prefetch" href="/assets/js/137.898fd9a1.js"><link rel="prefetch" href="/assets/js/138.c6591b9d.js"><link rel="prefetch" href="/assets/js/139.27a7976e.js"><link rel="prefetch" href="/assets/js/14.162fd7de.js"><link rel="prefetch" href="/assets/js/140.8f5fbf89.js"><link rel="prefetch" href="/assets/js/141.d2c4074e.js"><link rel="prefetch" href="/assets/js/142.ca465ae2.js"><link rel="prefetch" href="/assets/js/143.74deca00.js"><link rel="prefetch" href="/assets/js/144.70d74a91.js"><link rel="prefetch" href="/assets/js/145.6b2b56f8.js"><link rel="prefetch" href="/assets/js/146.f192058f.js"><link rel="prefetch" href="/assets/js/147.2dd1eca6.js"><link rel="prefetch" href="/assets/js/148.63cb766b.js"><link rel="prefetch" href="/assets/js/149.ecc8a933.js"><link rel="prefetch" href="/assets/js/15.5698f0da.js"><link rel="prefetch" href="/assets/js/150.4b4c3db8.js"><link rel="prefetch" href="/assets/js/16.5359a736.js"><link rel="prefetch" href="/assets/js/17.e09dee46.js"><link rel="prefetch" href="/assets/js/18.89fe105c.js"><link rel="prefetch" href="/assets/js/19.0ba8fb0f.js"><link rel="prefetch" href="/assets/js/20.a337dd2d.js"><link rel="prefetch" href="/assets/js/21.93618127.js"><link rel="prefetch" href="/assets/js/22.2956ed34.js"><link rel="prefetch" href="/assets/js/23.e7e073ac.js"><link rel="prefetch" href="/assets/js/24.6ae343c9.js"><link rel="prefetch" href="/assets/js/25.e5d4db2a.js"><link rel="prefetch" href="/assets/js/26.49ddf5e0.js"><link rel="prefetch" href="/assets/js/27.8ea45a54.js"><link rel="prefetch" href="/assets/js/28.ccb2b926.js"><link rel="prefetch" href="/assets/js/29.2433cbcd.js"><link rel="prefetch" href="/assets/js/30.b11f80e9.js"><link rel="prefetch" href="/assets/js/31.81256fb7.js"><link rel="prefetch" href="/assets/js/32.2ff0c303.js"><link rel="prefetch" href="/assets/js/33.4ce9ddd1.js"><link rel="prefetch" href="/assets/js/34.03bffcee.js"><link rel="prefetch" href="/assets/js/35.f8a9a551.js"><link rel="prefetch" href="/assets/js/36.8520137a.js"><link rel="prefetch" href="/assets/js/37.d9c6f0fa.js"><link rel="prefetch" href="/assets/js/38.92b36679.js"><link rel="prefetch" href="/assets/js/39.b958e128.js"><link rel="prefetch" href="/assets/js/4.c4d02356.js"><link rel="prefetch" href="/assets/js/40.29108793.js"><link rel="prefetch" href="/assets/js/41.a6366543.js"><link rel="prefetch" href="/assets/js/42.8b148511.js"><link rel="prefetch" href="/assets/js/43.e1763fb1.js"><link rel="prefetch" href="/assets/js/44.88d180c5.js"><link rel="prefetch" href="/assets/js/45.14b10a7d.js"><link rel="prefetch" href="/assets/js/46.93e3c7d7.js"><link rel="prefetch" href="/assets/js/47.e048c8cd.js"><link rel="prefetch" href="/assets/js/48.c5f9b4e8.js"><link rel="prefetch" href="/assets/js/49.70bccd74.js"><link rel="prefetch" href="/assets/js/5.4e88fd54.js"><link rel="prefetch" href="/assets/js/50.73312e50.js"><link rel="prefetch" href="/assets/js/51.e3a23273.js"><link rel="prefetch" href="/assets/js/52.ac5850db.js"><link rel="prefetch" href="/assets/js/53.964975e2.js"><link rel="prefetch" href="/assets/js/54.f8d8e32f.js"><link rel="prefetch" href="/assets/js/55.adab5810.js"><link rel="prefetch" href="/assets/js/56.aa0168c6.js"><link rel="prefetch" href="/assets/js/57.74697c72.js"><link rel="prefetch" href="/assets/js/58.0e7e958f.js"><link rel="prefetch" href="/assets/js/59.ee99df0c.js"><link rel="prefetch" href="/assets/js/6.b8b20bba.js"><link rel="prefetch" href="/assets/js/60.c20c903c.js"><link rel="prefetch" href="/assets/js/61.74ebb11f.js"><link rel="prefetch" href="/assets/js/62.5d7a7e72.js"><link rel="prefetch" href="/assets/js/63.c62b52d3.js"><link rel="prefetch" href="/assets/js/64.7c77fdd3.js"><link rel="prefetch" href="/assets/js/66.a7c3f8b7.js"><link rel="prefetch" href="/assets/js/67.95703483.js"><link rel="prefetch" href="/assets/js/68.6b4aef53.js"><link rel="prefetch" href="/assets/js/69.d94ed977.js"><link rel="prefetch" href="/assets/js/7.03c52a18.js"><link rel="prefetch" href="/assets/js/70.30b89105.js"><link rel="prefetch" href="/assets/js/71.7fb0a32a.js"><link rel="prefetch" href="/assets/js/72.04d95023.js"><link rel="prefetch" href="/assets/js/73.2ff7a268.js"><link rel="prefetch" href="/assets/js/74.d5c20b17.js"><link rel="prefetch" href="/assets/js/75.93bb57ce.js"><link rel="prefetch" href="/assets/js/76.55eb3fc8.js"><link rel="prefetch" href="/assets/js/77.5f66661c.js"><link rel="prefetch" href="/assets/js/78.14d0f57b.js"><link rel="prefetch" href="/assets/js/79.669c7d06.js"><link rel="prefetch" href="/assets/js/8.a356396f.js"><link rel="prefetch" href="/assets/js/80.efcf2688.js"><link rel="prefetch" href="/assets/js/81.d2e10130.js"><link rel="prefetch" href="/assets/js/82.b8ec9c21.js"><link rel="prefetch" href="/assets/js/83.9f22d6f2.js"><link rel="prefetch" href="/assets/js/84.4d1a6f69.js"><link rel="prefetch" href="/assets/js/85.d0dbb86b.js"><link rel="prefetch" href="/assets/js/86.3aa72ece.js"><link rel="prefetch" href="/assets/js/87.54f22267.js"><link rel="prefetch" href="/assets/js/88.85b21d95.js"><link rel="prefetch" href="/assets/js/89.2e8b9c83.js"><link rel="prefetch" href="/assets/js/9.ab3eeae2.js"><link rel="prefetch" href="/assets/js/90.61a4bb62.js"><link rel="prefetch" href="/assets/js/91.fef73b59.js"><link rel="prefetch" href="/assets/js/92.aec6eac0.js"><link rel="prefetch" href="/assets/js/93.caab4000.js"><link rel="prefetch" href="/assets/js/94.a156da91.js"><link rel="prefetch" href="/assets/js/95.a8412a27.js"><link rel="prefetch" href="/assets/js/96.d38de525.js"><link rel="prefetch" href="/assets/js/97.ede060e4.js"><link rel="prefetch" href="/assets/js/98.40ba68d7.js"><link rel="prefetch" href="/assets/js/99.fd9d661c.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.21f21cd2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.75c9abf4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/mt-logo-small.png" alt="MassTransit" class="logo"> <span class="site-name can-hide">MassTransit</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/discord.html" class="nav-link">
  Discord
</a></div><div class="nav-item"><a href="https://nuget.org/packages/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/discord.html" class="nav-link">
  Discord
</a></div><div class="nav-item"><a href="https://nuget.org/packages/MassTransit" target="_blank" rel="noopener noreferrer" class="nav-link external">
  NuGet
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/MassTransit/MassTransit" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/getting-started/" class="sidebar-heading clickable"><span>Getting Started</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/getting-started/live-coding.html" class="sidebar-link">Live Coding</a></li><li><a href="/getting-started/upgrade-v6.html" class="sidebar-link">Upgrading</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/releases/" class="sidebar-heading clickable"><span>Release Notes</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group depth-0"><a href="/usage/" class="sidebar-heading clickable"><span>Using MassTransit</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/usage/configuration.html" class="sidebar-link">Configuration</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/transports/" class="sidebar-heading clickable"><span>Transports</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/riders/" class="sidebar-heading clickable"><span>Riders</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/usage/mediator.html" class="sidebar-link">Mediator</a></li><li><a href="/usage/messages.html" class="sidebar-link">Messages</a></li><li><a href="/usage/consumers.html" class="sidebar-link">Consumers</a></li><li><a href="/usage/producers.html" class="sidebar-link">Producers</a></li><li><a href="/usage/exceptions.html" class="sidebar-link">Exceptions</a></li><li><a href="/usage/requests.html" class="sidebar-link">Requests</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/sagas/" class="sidebar-heading clickable"><span>Sagas</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/usage/containers/" class="sidebar-heading clickable"><span>Containers</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/usage/testing.html" class="sidebar-link">Testing</a></li><li><a href="/usage/logging.html" class="sidebar-link">Logging</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Advanced</span> <span class="arrow right"></span></p> <!----></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/learn/" class="sidebar-heading clickable"><span>Getting Help</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Articles</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/platform/" class="sidebar-heading clickable"><span>Platform</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Reference</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/architecture/packages.html" class="sidebar-link">Packages</a></li><li><a href="/architecture/interoperability.html" class="sidebar-link">Interoperability</a></li><li><a href="/architecture/nservicebus.html" class="sidebar-link">NServiceBus</a></li><li><a href="/architecture/versioning.html" class="sidebar-link">Versioning messages</a></li><li><a href="/architecture/newid.html" aria-current="page" class="active sidebar-link">NewId</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/architecture/newid.html#the-problem" class="sidebar-link">The Problem</a></li><li class="sidebar-sub-header"><a href="/architecture/newid.html#the-solution" class="sidebar-link">The Solution</a></li><li class="sidebar-sub-header"><a href="/architecture/newid.html#using-newid" class="sidebar-link">Using NewId</a></li></ul></li><li><a href="/architecture/encrypted-messages.html" class="sidebar-link">Encrypted Messages</a></li><li><a href="/architecture/green-cache.html" class="sidebar-link">Green Cache</a></li><li><a href="/architecture/history.html" class="sidebar-link">History</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="newid"><a href="#newid" class="header-anchor">#</a> NewId</h1> <p>NewId generates sequential unique identifiers that are 128-bit (16-bytes) and fit nicely into a <code>Guid</code>. It was inspired from <a href="https://blog.twitter.com/engineering/en_us/a/2010/announcing-snowflake.html" target="_blank" rel="noopener noreferrer">Snowflake<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and <a href="https://github.com/boundary/flake" target="_blank" rel="noopener noreferrer">flake<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="the-problem"><a href="#the-problem" class="header-anchor">#</a> The Problem</h2> <p>Many applications use unique identifiers to identify data. Common approaches applications use to generate unique identifiers in a relational database delegate identifier generation to the database, using an identity column or another similar auto-incrementing value.</p> <p>While this approach can be adequate for a small application, it quickly becomes a bottleneck at scale. And it's a common problem, as evidenced by <a href="https://blog.twitter.com/engineering/en_us/a/2010/announcing-snowflake.html" target="_blank" rel="noopener noreferrer">this post<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> from Twitter Engineering in 2010.</p> <div class="custom-block tip"><p class="custom-block-title">Quote</p> <p>We needed something that could generate tens of thousands of ids per second in a highly available manner. This naturally led us to choose an uncoordinated approach.</p></div> <p>A key use case, specifically related to MassTransit, is applications that use messages to communicate between services – which is common in a service-based architecture. In these applications, sequential identifiers generated by NewId can serve dual purposes. First and foremost, it is a sequential unique identifier. Second, it is also a timestamp, as every NewId includes a UTC timestamp.</p> <h3 id="why-does-order-matter-now"><a href="#why-does-order-matter-now" class="header-anchor">#</a> Why does order matter now?</h3> <p>For a .NET developer, it is easy to reach for <code>Guid.NewGuid()</code> and run with it. And while that works, the identifiers created are not sequential. They're completely randomized. And when it comes to data, being able to sort it matters. Using a <em>uniqueidentifier</em> column as a primary key clustered index with SQL Server was frowned upon for years because it caused massive index fragmentation. This led developers to use an <em>int</em> (or <em>bigint</em> once they realized that four billion isn't a lot) primary key and create a separate unique index on the <em>uniqueidentifier</em> column (to use the AK, one might say, it wasn't a good day).</p> <h2 id="the-solution"><a href="#the-solution" class="header-anchor">#</a> The Solution</h2> <p>NewId was created to solve the problem. NewId generates sequential 128-bit identifiers that are collation compatible with SQL Server as a clustered primary key. Using the host MAC address, along with an optional offset (in case multiple processes are on the same host), combined with a timestamp and an incrementing sequence number, generate identifiers are unique across a network of systems and can be safely inserted into a database without conflicts.</p> <blockquote><p>NewId is largely inspired by the <a href="https://github.com/boundary/flake" target="_blank" rel="noopener noreferrer">Erlang library flake<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which adopted an approach of generating 128-bit, k-ordered ids (read time-ordered lexically) using the machines MAC, timestamp and a per-thread sequence number. These identifiers are sequential and do not collide in a cluster of nodes running applications that use these as UUIDs.</p></blockquote> <h2 id="using-newid"><a href="#using-newid" class="header-anchor">#</a> Using NewId</h2> <p>NewIds can be generated using one of two methods. The first returns a <code>NewId</code>, whereas the second returns a <code>Guid</code>.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token class-name">NewId</span> newId <span class="token operator">=</span> NewId<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name">Guid</span> guid <span class="token operator">=</span> NewId<span class="token punctuation">.</span><span class="token function">NextGuid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>NewId implements many of the same methods and constructors as <em>Guid</em>, and can be converted to and from a <em>Guid</em>.</p> <div class="language-cs extra-class"><pre class="language-cs"><code><span class="token comment">// Formats to 11790000-CF25-B808-2365-08D36732603A</span>
<span class="token class-name"><span class="token keyword">string</span></span> identifier <span class="token operator">=</span> NewId<span class="token punctuation">.</span><span class="token function">Next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token string">&quot;D&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToUpperInvariant</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Convert from a string</span>
<span class="token class-name">NewId</span> newId <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">NewId</span><span class="token punctuation">(</span><span class="token string">&quot;11790000-cf25-b808-dc58-08d367322210&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Convert from a byte array</span>
<span class="token class-name"><span class="token keyword">var</span></span> bytes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token punctuation">{</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">54</span><span class="token punctuation">,</span> <span class="token number">74</span><span class="token punctuation">,</span> <span class="token number">21</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">44</span><span class="token punctuation">,</span> <span class="token number">41</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">86</span><span class="token punctuation">,</span> <span class="token number">42</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">NewId</span> newId <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">NewId</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="configuration"><a href="#configuration" class="header-anchor">#</a> Configuration</h3> <p>Some features of NewId can be configured.</p> <h4 id="process-id"><a href="#process-id" class="header-anchor">#</a> Process Id</h4> <p>In cases where multiple processes are on the same host generating identifiers, it may be necessary to include the <em>processId</em> when generating identifiers. To enable the use of the <em>processId</em>, call the method below on startup.</p> <div class="language-cs extra-class"><pre class="language-cs"><code>NewId<span class="token punctuation">.</span><span class="token function">SetProcessIdProvider</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">CurrentProcessIdProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>This will replace two of the six network address bytes with the current <em>processId</em>.</p> <div class="custom-block danger"><p class="custom-block-title">WARNING</p> <p>There are situations where using a predictable, sequential identifier is discouraged – cases where unpreditability is a desired feature. These include:</p> <ul><li>Generating passwords</li> <li>Creating security tokens</li> <li>Anything where someone should not be able to guess an identifier</li></ul> <p>NewId generated identifiers may expose the MAC address of the machine that generated the identifier along with the time the identifier was generated. While this isn't typically an issue in the modern world of networked computers with soft MAC addresses, some security-sensitive applications may need to be aware of the algorithm and any ramifications.</p> <p>Oh, and <strong>don't</strong> do modulo 2 arithmetic on NewId-generated Guids with an expectation of random distribution.</p></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/MassTransit/MassTransit/edit/develop/docs/architecture/newid.md" target="_blank" rel="noopener noreferrer">Help us by improving this page!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">5/13/2020, 12:01:58 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/architecture/versioning.html" class="prev">
        Versioning messages
      </a></span> <span class="next"><a href="/architecture/encrypted-messages.html">
        Encrypted Messages
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.195ff7db.js" defer></script><script src="/assets/js/3.49f501da.js" defer></script><script src="/assets/js/65.cb59ccfd.js" defer></script>
  </body>
</html>
